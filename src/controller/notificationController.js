const {ethers} = require("ethers");
module.exports = (container) => {
    const logger = container.resolve('logger')
    const ObjectId = container.resolve('ObjectId')

    const {
        schemaValidator,
        schemas: {
            Campaign
        }
    } = container.resolve('models')
    const { httpCode, serverHelper } = container.resolve('config')

    const { provider } = container.resolve('ethers');

    const NOTIFICATION_CONTRACT_ADDR = '0x8E6ac0390fDEe3563b4d9D1a0d9D1C4bfECD36F5'
    const NOTIFICATION_CONTRACT = [
        'function register(string,string,string) external',
        'function unregister(string) external',
        'function update(string,string,string) external',
        'function get(string) external view returns (string, string, address)'
    ]

    const WALLET_CONTRACT_ABI =[
        'function addOwner(address) public',
        'function withdraw(address, uint) external',
        'function submitTransaction(address,uint,bytes,address)',
        'function confirmTransaction(uint) public',
        'function executeTransaction(uint) public',
        'function revokeConfirmation(uint) public',
        'function getBalance() external view',
        'function getOwners() public view',
        'function getOwners() public view',
        'function getTransactions() public view',
        'function getTokens() public view',
        'function getTransactionCount() public view',
        'function getTransaction(uint) public view',
        'function addTokenManage(address)',
        'function createToken(string,string,uint8,uint256) public',
        'function getBalanceOfToken(address,address) public view'
    ]

    const WALLET_CONTRACT_BYTECODE = '0x60806040526040516200570f3803806200570f8339818101604052810190620000299190620005f8565b600081511162000070576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016200006790620006f3565b60405180910390fd5b60008211801562000082575080518211155b620000c4576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401620000bb906200078b565b60405180910390fd5b60005b8151811015620002c7576000828281518110620000e957620000e8620007ad565b5b60200260200101519050600073ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff160362000165576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016200015c906200082c565b60405180910390fd5b600560008273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff1615620001f5576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401620001ec906200089e565b60405180910390fd5b6001600560008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff0219169083151502179055506002819080600181540180825580915050600190039060005260206000200160009091909190916101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550508080620002be90620008ef565b915050620000c7565b508260009081620002d9919062000b7d565b508160018190555050505062000c64565b6000604051905090565b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b620003538262000308565b810181811067ffffffffffffffff8211171562000375576200037462000319565b5b80604052505050565b60006200038a620002ea565b905062000398828262000348565b919050565b600067ffffffffffffffff821115620003bb57620003ba62000319565b5b620003c68262000308565b9050602081019050919050565b60005b83811015620003f3578082015181840152602081019050620003d6565b60008484015250505050565b60006200041662000410846200039d565b6200037e565b90508281526020810184848401111562000435576200043462000303565b5b62000442848285620003d3565b509392505050565b600082601f830112620004625762000461620002fe565b5b815162000474848260208601620003ff565b91505092915050565b6000819050919050565b62000492816200047d565b81146200049e57600080fd5b50565b600081519050620004b28162000487565b92915050565b600067ffffffffffffffff821115620004d657620004d562000319565b5b602082029050602081019050919050565b600080fd5b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b60006200051982620004ec565b9050919050565b6200052b816200050c565b81146200053757600080fd5b50565b6000815190506200054b8162000520565b92915050565b6000620005686200056284620004b8565b6200037e565b905080838252602082019050602084028301858111156200058e576200058d620004e7565b5b835b81811015620005bb5780620005a688826200053a565b84526020840193505060208101905062000590565b5050509392505050565b600082601f830112620005dd57620005dc620002fe565b5b8151620005ef84826020860162000551565b91505092915050565b600080600060608486031215620006145762000613620002f4565b5b600084015167ffffffffffffffff811115620006355762000634620002f9565b5b62000643868287016200044a565b93505060206200065686828701620004a1565b925050604084015167ffffffffffffffff8111156200067a5762000679620002f9565b5b6200068886828701620005c5565b9150509250925092565b600082825260208201905092915050565b7f4f776e6572732072657175697265640000000000000000000000000000000000600082015250565b6000620006db600f8362000692565b9150620006e882620006a3565b602082019050919050565b600060208201905081810360008301526200070e81620006cc565b9050919050565b7f496e76616c6964206e756d626572206f6620726571756972656420636f6e666960008201527f726d6174696f6e73000000000000000000000000000000000000000000000000602082015250565b60006200077360288362000692565b9150620007808262000715565b604082019050919050565b60006020820190508181036000830152620007a68162000764565b9050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b7f696e76616c6964206f776e657200000000000000000000000000000000000000600082015250565b600062000814600d8362000692565b91506200082182620007dc565b602082019050919050565b60006020820190508181036000830152620008478162000805565b9050919050565b7f6f776e6572206e6f7420756e6971756500000000000000000000000000000000600082015250565b60006200088660108362000692565b915062000893826200084e565b602082019050919050565b60006020820190508181036000830152620008b98162000877565b9050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b6000620008fc826200047d565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8203620009315762000930620008c0565b5b600182019050919050565b600081519050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b600060028204905060018216806200098f57607f821691505b602082108103620009a557620009a462000947565b5b50919050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b60006008830262000a0f7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82620009d0565b62000a1b8683620009d0565b95508019841693508086168417925050509392505050565b6000819050919050565b600062000a5e62000a5862000a52846200047d565b62000a33565b6200047d565b9050919050565b6000819050919050565b62000a7a8362000a3d565b62000a9262000a898262000a65565b848454620009dd565b825550505050565b600090565b62000aa962000a9a565b62000ab681848462000a6f565b505050565b5b8181101562000ade5762000ad260008262000a9f565b60018101905062000abc565b5050565b601f82111562000b2d5762000af781620009ab565b62000b0284620009c0565b8101602085101562000b12578190505b62000b2a62000b2185620009c0565b83018262000abb565b50505b505050565b600082821c905092915050565b600062000b526000198460080262000b32565b1980831691505092915050565b600062000b6d838362000b3f565b9150826002028217905092915050565b62000b88826200093c565b67ffffffffffffffff81111562000ba45762000ba362000319565b5b62000bb0825462000976565b62000bbd82828562000ae2565b600060209050601f83116001811462000bf5576000841562000be0578287015190505b62000bec858262000b5f565b86555062000c5c565b601f19841662000c0586620009ab565b60005b8281101562000c2f5784890151825560018201915060208501945060208101905062000c08565b8683101562000c4f578489015162000c4b601f89168262000b3f565b8355505b6001600288020188555050505b505050505050565b614a9b8062000c746000396000f3fe608060405260043610620001335760003560e01c806380f59a6511620000af578063b3128fc5116200006d578063b3128fc5146200049a578063c01a8c8414620004c8578063d0549b8514620004f6578063ee22610b1462000526578063f3fef3a31462000554576200018d565b806380f59a65146200037d57806383920e9014620003c15780639ace38c214620003f1578063a0e67e2b146200043a578063aa6ca808146200046a576200018d565b80632e7700f011620000fd5780632e7700f0146200026457806333ea3dc814620002945780635754429114620002dd5780636513aba3146200030b5780637065cb48146200034f576200018d565b806306fdde03146200019257806312065fe014620001c257806320ea8d8614620001f2578063210f5dda1462000220576200018d565b366200018d573373ffffffffffffffffffffffffffffffffffffffff167f90890809c654f11d6e72a28fa60149770a0d11ec6c92319d6ceb2bb0a4ea1a1534476040516200018392919062001fe5565b60405180910390a2005b600080fd5b3480156200019f57600080fd5b50620001aa62000582565b604051620001b99190620020ac565b60405180910390f35b348015620001cf57600080fd5b50620001da62000618565b604051620001e99190620020d0565b60405180910390f35b348015620001ff57600080fd5b506200021e600480360381019062000218919062002132565b62000620565b005b3480156200022d57600080fd5b506200024c6004803603810190620002469190620022f3565b6200090e565b6040516200025b91906200242e565b60405180910390f35b3480156200027157600080fd5b506200027c62000a51565b6040516200028b9190620020d0565b60405180910390f35b348015620002a157600080fd5b50620002c06004803603810190620002ba919062002132565b62000a5e565b604051620002d496959493929190620024ea565b60405180910390f35b348015620002ea57600080fd5b5062000309600480360381019062000303919062002643565b62000ba4565b005b3480156200031857600080fd5b50620003376004803603810190620003319190620026d4565b62000e7b565b604051620003469190620020d0565b60405180910390f35b3480156200035c57600080fd5b506200037b60048036038101906200037591906200271b565b62000f04565b005b3480156200038a57600080fd5b50620003a96004803603810190620003a391906200274d565b620010cc565b604051620003b8919062002794565b60405180910390f35b348015620003ce57600080fd5b50620003d9620010fb565b604051620003e891906200299b565b60405180910390f35b348015620003fe57600080fd5b506200041d600480360381019062000417919062002132565b620012d1565b6040516200043196959493929190620029bf565b60405180910390f35b3480156200044757600080fd5b5062000452620013fb565b60405162000461919062002af0565b60405180910390f35b3480156200047757600080fd5b50620004826200148b565b60405162000491919062002af0565b60405180910390f35b348015620004a757600080fd5b50620004c66004803603810190620004c091906200271b565b6200151b565b005b348015620004d557600080fd5b50620004f46004803603810190620004ee919062002132565b620016f8565b005b3480156200050357600080fd5b506200050e620019e9565b6040516200051d9190620020d0565b60405180910390f35b3480156200053357600080fd5b506200055260048036038101906200054c919062002132565b620019ef565b005b3480156200056157600080fd5b506200058060048036038101906200057a919062002b59565b62001e30565b005b60008054620005919062002bcf565b80601f0160208091040260200160405190810160405280929190818152602001828054620005bf9062002bcf565b8015620006105780601f10620005e45761010080835404028352916020019162000610565b820191906000526020600020905b815481529060010190602001808311620005f257829003601f168201915b505050505081565b600047905090565b600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff16620006af576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401620006a69062002c54565b60405180910390fd5b806007805490508110620006fa576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401620006f19062002cc6565b60405180910390fd5b816007818154811062000712576200071162002ce8565b5b906000526020600020906005020160040160009054906101000a900460ff161562000774576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016200076b9062002d67565b60405180910390fd5b6000600784815481106200078d576200078c62002ce8565b5b906000526020600020906005020190506006600085815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff166200083d576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401620008349062002dd9565b60405180910390fd5b600181600301600082825462000854919062002e2a565b9250508190555060006006600086815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff021916908315150217905550833373ffffffffffffffffffffffffffffffffffffffff167ff0dca620e2e81f7841d07bcc105e1704fb01475b278a9d4c236e1c62945edd5560405160405180910390a350505050565b6000600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff166200099f576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401620009969062002c54565b60405180910390fd5b600085858585604051620009b39062001fbc565b620009c2949392919062002e76565b604051809103906000f080158015620009df573d6000803e3d6000fd5b5090506003819080600181540180825580915050600190039060005260206000200160009091909190916101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555080915050949350505050565b6000600780549050905090565b60008060606000806000806007888154811062000a805762000a7f62002ce8565b5b906000526020600020906005020190508060000160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff168160010154826002018360040160009054906101000a900460ff1684600301548560040160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff1683805462000b089062002bcf565b80601f016020809104026020016040519081016040528092919081815260200182805462000b369062002bcf565b801562000b875780601f1062000b5b5761010080835404028352916020019162000b87565b820191906000526020600020905b81548152906001019060200180831162000b6957829003601f168201915b505050505093509650965096509650965096505091939550919395565b600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff1662000c33576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040162000c2a9062002c54565b60405180910390fd5b6000600780549050905060076040518060c001604052808773ffffffffffffffffffffffffffffffffffffffff168152602001868152602001858152602001600181526020016000151581526020018473ffffffffffffffffffffffffffffffffffffffff16815250908060018154018082558091505060019003906000526020600020906005020160009091909190915060008201518160000160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555060208201518160010155604082015181600201908162000d2d919062003099565b506060820151816003015560808201518160040160006101000a81548160ff02191690831515021790555060a08201518160040160016101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550505060016006600083815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff0219169083151502179055508473ffffffffffffffffffffffffffffffffffffffff16813373ffffffffffffffffffffffffffffffffffffffff167fd5a05bf70715ad82a09a756320284a1b54c9ff74cd0f8cce6219e79b563fe59d878760405162000e6c92919062003180565b60405180910390a45050505050565b60008273ffffffffffffffffffffffffffffffffffffffff166370a08231836040518263ffffffff1660e01b815260040162000eb89190620031b4565b602060405180830381865afa15801562000ed6573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019062000efc9190620031e8565b905092915050565b600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff1662000f93576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040162000f8a9062002c54565b60405180910390fd5b600560008273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff161562001023576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016200101a906200326a565b60405180910390fd5b6002819080600181540180825580915050600190039060005260206000200160009091909190916101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508073ffffffffffffffffffffffffffffffffffffffff167fac1e9ef41b54c676ccf449d83ae6f2624bcdce8f5b93a6b48ce95874c332693d60405160405180910390a250565b60066020528160005260406000206020528060005260406000206000915091509054906101000a900460ff1681565b60606007805480602002602001604051908101604052809291908181526020016000905b82821015620012c857838290600052602060002090600502016040518060c00160405290816000820160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200160018201548152602001600282018054620011b59062002bcf565b80601f0160208091040260200160405190810160405280929190818152602001828054620011e39062002bcf565b8015620012345780601f10620012085761010080835404028352916020019162001234565b820191906000526020600020905b8154815290600101906020018083116200121657829003601f168201915b50505050508152602001600382015481526020016004820160009054906101000a900460ff161515151581526020016004820160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681525050815260200190600101906200111f565b50505050905090565b60078181548110620012e257600080fd5b90600052602060002090600502016000915090508060000160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1690806001015490806002018054620013339062002bcf565b80601f0160208091040260200160405190810160405280929190818152602001828054620013619062002bcf565b8015620013b25780601f106200138657610100808354040283529160200191620013b2565b820191906000526020600020905b8154815290600101906020018083116200139457829003601f168201915b5050505050908060030154908060040160009054906101000a900460ff16908060040160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905086565b606060028054806020026020016040519081016040528092919081815260200182805480156200148157602002820191906000526020600020905b8160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001906001019080831162001436575b5050505050905090565b606060038054806020026020016040519081016040528092919081815260200182805480156200151157602002820191906000526020600020905b8160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019060010190808311620014c6575b5050505050905090565b600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff16620015aa576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401620015a19062002c54565b60405180910390fd5b600460008273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff16156200163a576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016200163190620032dc565b60405180910390fd5b6001600460008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff0219169083151502179055506003819080600181540180825580915050600190039060005260206000200160009091909190916101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555050565b600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff1662001787576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016200177e9062002c54565b60405180910390fd5b806007805490508110620017d2576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401620017c99062002cc6565b60405180910390fd5b8160078181548110620017ea57620017e962002ce8565b5b906000526020600020906005020160040160009054906101000a900460ff16156200184c576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401620018439062002d67565b60405180910390fd5b826006600082815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff1615620018ee576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401620018e5906200334e565b60405180910390fd5b60006007858154811062001907576200190662002ce8565b5b9060005260206000209060050201905060018160030160008282546200192e919062003370565b9250508190555060016006600087815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff021916908315150217905550843373ffffffffffffffffffffffffffffffffffffffff167f5cbe105e36805f7820e291f799d5794ff948af2a5f664e580382defb6339004160405160405180910390a35050505050565b60015481565b600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff1662001a7e576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040162001a759062002c54565b60405180910390fd5b80600780549050811062001ac9576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040162001ac09062002cc6565b60405180910390fd5b816007818154811062001ae15762001ae062002ce8565b5b906000526020600020906005020160040160009054906101000a900460ff161562001b43576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040162001b3a9062002d67565b60405180910390fd5b60006007848154811062001b5c5762001b5b62002ce8565b5b906000526020600020906005020190506001548160030154101562001bb8576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040162001baf90620033fb565b60405180910390fd5b60018160040160006101000a81548160ff021916908315150217905550600073ffffffffffffffffffffffffffffffffffffffff168160040160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff161462001d04578060040160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663a9059cbb8260000160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1683600101546040518363ffffffff1660e01b815260040162001cb79291906200341d565b6020604051808303816000875af115801562001cd7573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019062001cfd91906200347b565b5062001de6565b60008160000160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1682600101548360020160405162001d59919062003547565b60006040518083038185875af1925050503d806000811462001d98576040519150601f19603f3d011682016040523d82523d6000602084013e62001d9d565b606091505b505090508062001de4576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040162001ddb90620035b0565b60405180910390fd5b505b833373ffffffffffffffffffffffffffffffffffffffff167f5445f318f4f5fcfb66592e68e0cc5822aa15664039bd5f0ffde24c5a8142b1ac60405160405180910390a350505050565b600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff1662001ebf576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040162001eb69062002c54565b60405180910390fd5b47811062001f04576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040162001efb9062003622565b60405180910390fd5b60008273ffffffffffffffffffffffffffffffffffffffff168260405162001f2c9062003694565b60006040518083038185875af1925050503d806000811462001f6b576040519150601f19603f3d011682016040523d82523d6000602084013e62001f70565b606091505b505090508062001fb7576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040162001fae90620035b0565b60405180910390fd5b505050565b6113ba80620036ac83390190565b6000819050919050565b62001fdf8162001fca565b82525050565b600060408201905062001ffc600083018562001fd4565b6200200b602083018462001fd4565b9392505050565b600081519050919050565b600082825260208201905092915050565b60005b838110156200204e57808201518184015260208101905062002031565b60008484015250505050565b6000601f19601f8301169050919050565b6000620020788262002012565b6200208481856200201d565b9350620020968185602086016200202e565b620020a1816200205a565b840191505092915050565b60006020820190508181036000830152620020c881846200206b565b905092915050565b6000602082019050620020e7600083018462001fd4565b92915050565b6000604051905090565b600080fd5b600080fd5b6200210c8162001fca565b81146200211857600080fd5b50565b6000813590506200212c8162002101565b92915050565b6000602082840312156200214b576200214a620020f7565b5b60006200215b848285016200211b565b91505092915050565b600080fd5b600080fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b620021a8826200205a565b810181811067ffffffffffffffff82111715620021ca57620021c96200216e565b5b80604052505050565b6000620021df620020ed565b9050620021ed82826200219d565b919050565b600067ffffffffffffffff82111562002210576200220f6200216e565b5b6200221b826200205a565b9050602081019050919050565b82818337600083830152505050565b60006200224e6200224884620021f2565b620021d3565b9050828152602081018484840111156200226d576200226c62002169565b5b6200227a84828562002228565b509392505050565b600082601f8301126200229a576200229962002164565b5b8135620022ac84826020860162002237565b91505092915050565b600060ff82169050919050565b620022cd81620022b5565b8114620022d957600080fd5b50565b600081359050620022ed81620022c2565b92915050565b6000806000806080858703121562002310576200230f620020f7565b5b600085013567ffffffffffffffff811115620023315762002330620020fc565b5b6200233f8782880162002282565b945050602085013567ffffffffffffffff811115620023635762002362620020fc565b5b620023718782880162002282565b93505060406200238487828801620022dc565b925050606062002397878288016200211b565b91505092959194509250565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000819050919050565b6000620023ee620023e8620023e284620023a3565b620023c3565b620023a3565b9050919050565b60006200240282620023cd565b9050919050565b60006200241682620023f5565b9050919050565b620024288162002409565b82525050565b60006020820190506200244560008301846200241d565b92915050565b60006200245882620023a3565b9050919050565b6200246a816200244b565b82525050565b600081519050919050565b600082825260208201905092915050565b6000620024998262002470565b620024a581856200247b565b9350620024b78185602086016200202e565b620024c2816200205a565b840191505092915050565b60008115159050919050565b620024e481620024cd565b82525050565b600060c0820190506200250160008301896200245f565b62002510602083018862001fd4565b81810360408301526200252481876200248c565b9050620025356060830186620024d9565b62002544608083018562001fd4565b6200255360a08301846200245f565b979650505050505050565b62002569816200244b565b81146200257557600080fd5b50565b60008135905062002589816200255e565b92915050565b600067ffffffffffffffff821115620025ad57620025ac6200216e565b5b620025b8826200205a565b9050602081019050919050565b6000620025dc620025d6846200258f565b620021d3565b905082815260208101848484011115620025fb57620025fa62002169565b5b6200260884828562002228565b509392505050565b600082601f83011262002628576200262762002164565b5b81356200263a848260208601620025c5565b91505092915050565b6000806000806080858703121562002660576200265f620020f7565b5b6000620026708782880162002578565b945050602062002683878288016200211b565b935050604085013567ffffffffffffffff811115620026a757620026a6620020fc565b5b620026b58782880162002610565b9250506060620026c88782880162002578565b91505092959194509250565b60008060408385031215620026ee57620026ed620020f7565b5b6000620026fe8582860162002578565b9250506020620027118582860162002578565b9150509250929050565b600060208284031215620027345762002733620020f7565b5b6000620027448482850162002578565b91505092915050565b60008060408385031215620027675762002766620020f7565b5b600062002777858286016200211b565b92505060206200278a8582860162002578565b9150509250929050565b6000602082019050620027ab6000830184620024d9565b92915050565b600081519050919050565b600082825260208201905092915050565b6000819050602082019050919050565b620027e8816200244b565b82525050565b620027f98162001fca565b82525050565b600082825260208201905092915050565b60006200281d8262002470565b620028298185620027ff565b93506200283b8185602086016200202e565b62002846816200205a565b840191505092915050565b6200285c81620024cd565b82525050565b600060c0830160008301516200287c6000860182620027dd565b506020830151620028916020860182620027ee565b5060408301518482036040860152620028ab828262002810565b9150506060830151620028c26060860182620027ee565b506080830151620028d7608086018262002851565b5060a0830151620028ec60a0860182620027dd565b508091505092915050565b600062002905838362002862565b905092915050565b6000602082019050919050565b60006200292782620027b1565b620029338185620027bc565b9350836020820285016200294785620027cd565b8060005b85811015620029895784840389528151620029678582620028f7565b945062002974836200290d565b925060208a019950506001810190506200294b565b50829750879550505050505092915050565b60006020820190508181036000830152620029b781846200291a565b905092915050565b600060c082019050620029d660008301896200245f565b620029e5602083018862001fd4565b8181036040830152620029f981876200248c565b905062002a0a606083018662001fd4565b62002a196080830185620024d9565b62002a2860a08301846200245f565b979650505050505050565b600081519050919050565b600082825260208201905092915050565b6000819050602082019050919050565b600062002a6d8383620027dd565b60208301905092915050565b6000602082019050919050565b600062002a938262002a33565b62002a9f818562002a3e565b935062002aac8362002a4f565b8060005b8381101562002ae357815162002ac7888262002a5f565b975062002ad48362002a79565b92505060018101905062002ab0565b5085935050505092915050565b6000602082019050818103600083015262002b0c818462002a86565b905092915050565b600062002b2182620023a3565b9050919050565b62002b338162002b14565b811462002b3f57600080fd5b50565b60008135905062002b538162002b28565b92915050565b6000806040838503121562002b735762002b72620020f7565b5b600062002b838582860162002b42565b925050602062002b96858286016200211b565b9150509250929050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b6000600282049050600182168062002be857607f821691505b60208210810362002bfe5762002bfd62002ba0565b5b50919050565b7f4e6f74206f776e65720000000000000000000000000000000000000000000000600082015250565b600062002c3c6009836200201d565b915062002c498262002c04565b602082019050919050565b6000602082019050818103600083015262002c6f8162002c2d565b9050919050565b7f747820646f6573206e6f74206578697374000000000000000000000000000000600082015250565b600062002cae6011836200201d565b915062002cbb8262002c76565b602082019050919050565b6000602082019050818103600083015262002ce18162002c9f565b9050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b7f747820616c726561647920657865637574656400000000000000000000000000600082015250565b600062002d4f6013836200201d565b915062002d5c8262002d17565b602082019050919050565b6000602082019050818103600083015262002d828162002d40565b9050919050565b7f7478206e6f7420636f6e6669726d656400000000000000000000000000000000600082015250565b600062002dc16010836200201d565b915062002dce8262002d89565b602082019050919050565b6000602082019050818103600083015262002df48162002db2565b9050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b600062002e378262001fca565b915062002e448362001fca565b925082820390508181111562002e5f5762002e5e62002dfb565b5b92915050565b62002e7081620022b5565b82525050565b6000608082019050818103600083015262002e9281876200206b565b9050818103602083015262002ea881866200206b565b905062002eb9604083018562002e65565b62002ec8606083018462001fd4565b95945050505050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b60006008830262002f357fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8262002ef6565b62002f41868362002ef6565b95508019841693508086168417925050509392505050565b600062002f7a62002f7462002f6e8462001fca565b620023c3565b62001fca565b9050919050565b6000819050919050565b62002f968362002f59565b62002fae62002fa58262002f81565b84845462002f03565b825550505050565b600090565b62002fc562002fb6565b62002fd281848462002f8b565b505050565b5b8181101562002ffa5762002fee60008262002fbb565b60018101905062002fd8565b5050565b601f8211156200304957620030138162002ed1565b6200301e8462002ee6565b810160208510156200302e578190505b620030466200303d8562002ee6565b83018262002fd7565b50505b505050565b600082821c905092915050565b60006200306e600019846008026200304e565b1980831691505092915050565b60006200308983836200305b565b9150826002028217905092915050565b620030a48262002470565b67ffffffffffffffff811115620030c057620030bf6200216e565b5b620030cc825462002bcf565b620030d982828562002ffe565b600060209050601f831160018114620031115760008415620030fc578287015190505b6200310885826200307b565b86555062003178565b601f198416620031218662002ed1565b60005b828110156200314b5784890151825560018201915060208501945060208101905062003124565b868310156200316b578489015162003167601f8916826200305b565b8355505b6001600288020188555050505b505050505050565b600060408201905062003197600083018562001fd4565b8181036020830152620031ab81846200248c565b90509392505050565b6000602082019050620031cb60008301846200245f565b92915050565b600081519050620031e28162002101565b92915050565b600060208284031215620032015762003200620020f7565b5b60006200321184828501620031d1565b91505092915050565b7f4f776e6572206e6f7420756e6971756500000000000000000000000000000000600082015250565b6000620032526010836200201d565b91506200325f826200321a565b602082019050919050565b60006020820190508181036000830152620032858162003243565b9050919050565b7f546f6b656e206e6f7420756e6971756500000000000000000000000000000000600082015250565b6000620032c46010836200201d565b9150620032d1826200328c565b602082019050919050565b60006020820190508181036000830152620032f781620032b5565b9050919050565b7f747820616c726561647920636f6e6669726d6564000000000000000000000000600082015250565b6000620033366014836200201d565b91506200334382620032fe565b602082019050919050565b60006020820190508181036000830152620033698162003327565b9050919050565b60006200337d8262001fca565b91506200338a8362001fca565b9250828201905080821115620033a557620033a462002dfb565b5b92915050565b7f63616e6e6f742065786563757465207478000000000000000000000000000000600082015250565b6000620033e36011836200201d565b9150620033f082620033ab565b602082019050919050565b600060208201905081810360008301526200341681620033d4565b9050919050565b60006040820190506200343460008301856200245f565b62003443602083018462001fd4565b9392505050565b6200345581620024cd565b81146200346157600080fd5b50565b60008151905062003475816200344a565b92915050565b600060208284031215620034945762003493620020f7565b5b6000620034a48482850162003464565b91505092915050565b600081905092915050565b60008154620034c78162002bcf565b620034d38186620034ad565b94506001821660008114620034f1576001811462003507576200353e565b60ff19831686528115158202860193506200353e565b620035128562002ed1565b60005b83811015620035365781548189015260018201915060208101905062003515565b838801955050505b50505092915050565b6000620035558284620034b8565b915081905092915050565b7f7478206661696c65640000000000000000000000000000000000000000000000600082015250565b6000620035986009836200201d565b9150620035a58262003560565b602082019050919050565b60006020820190508181036000830152620035cb8162003589565b9050919050565b7f4574686572206e6f7420656e6f75676800000000000000000000000000000000600082015250565b60006200360a6010836200201d565b91506200361782620035d2565b602082019050919050565b600060208201905081810360008301526200363d81620035fb565b9050919050565b7f77697468647261772065746820746f207b5f64657374696e6174696f6e7d0000600082015250565b60006200367c601e83620034ad565b9150620036898262003644565b601e82019050919050565b6000620036a1826200366d565b915081905091905056fe60806040523480156200001157600080fd5b50604051620013ba380380620013ba8339818101604052810190620000379190620002d9565b8360009081620000489190620005ca565b5082600190816200005a9190620005ca565b5081600260006101000a81548160ff021916908360ff16021790555080600581905550600554600360003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208190555050505050620006b1565b6000604051905090565b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b6200013682620000eb565b810181811067ffffffffffffffff82111715620001585762000157620000fc565b5b80604052505050565b60006200016d620000cd565b90506200017b82826200012b565b919050565b600067ffffffffffffffff8211156200019e576200019d620000fc565b5b620001a982620000eb565b9050602081019050919050565b60005b83811015620001d6578082015181840152602081019050620001b9565b60008484015250505050565b6000620001f9620001f38462000180565b62000161565b905082815260208101848484011115620002185762000217620000e6565b5b62000225848285620001b6565b509392505050565b600082601f830112620002455762000244620000e1565b5b815162000257848260208601620001e2565b91505092915050565b600060ff82169050919050565b620002788162000260565b81146200028457600080fd5b50565b60008151905062000298816200026d565b92915050565b6000819050919050565b620002b3816200029e565b8114620002bf57600080fd5b50565b600081519050620002d381620002a8565b92915050565b60008060008060808587031215620002f657620002f5620000d7565b5b600085015167ffffffffffffffff811115620003175762000316620000dc565b5b62000325878288016200022d565b945050602085015167ffffffffffffffff811115620003495762000348620000dc565b5b62000357878288016200022d565b93505060406200036a8782880162000287565b92505060606200037d87828801620002c2565b91505092959194509250565b600081519050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b60006002820490506001821680620003dc57607f821691505b602082108103620003f257620003f162000394565b5b50919050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b6000600883026200045c7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff826200041d565b6200046886836200041d565b95508019841693508086168417925050509392505050565b6000819050919050565b6000620004ab620004a56200049f846200029e565b62000480565b6200029e565b9050919050565b6000819050919050565b620004c7836200048a565b620004df620004d682620004b2565b8484546200042a565b825550505050565b600090565b620004f6620004e7565b62000503818484620004bc565b505050565b5b818110156200052b576200051f600082620004ec565b60018101905062000509565b5050565b601f8211156200057a576200054481620003f8565b6200054f846200040d565b810160208510156200055f578190505b620005776200056e856200040d565b83018262000508565b50505b505050565b600082821c905092915050565b60006200059f600019846008026200057f565b1980831691505092915050565b6000620005ba83836200058c565b9150826002028217905092915050565b620005d58262000389565b67ffffffffffffffff811115620005f157620005f0620000fc565b5b620005fd8254620003c3565b6200060a8282856200052f565b600060209050601f8311600181146200064257600084156200062d578287015190505b620006398582620005ac565b865550620006a9565b601f1984166200065286620003f8565b60005b828110156200067c5784890151825560018201915060208501945060208101905062000655565b868310156200069c578489015162000698601f8916826200058c565b8355505b6001600288020188555050505b505050505050565b610cf980620006c16000396000f3fe608060405234801561001057600080fd5b50600436106100935760003560e01c8063313ce56711610066578063313ce5671461013457806370a082311461015257806395d89b4114610182578063a9059cbb146101a0578063dd62ed3e146101d057610093565b806306fdde0314610098578063095ea7b3146100b657806318160ddd146100e657806323b872dd14610104575b600080fd5b6100a0610200565b6040516100ad919061097a565b60405180910390f35b6100d060048036038101906100cb9190610a35565b61028e565b6040516100dd9190610a90565b60405180910390f35b6100ee610380565b6040516100fb9190610aba565b60405180910390f35b61011e60048036038101906101199190610ad5565b61038a565b60405161012b9190610a90565b60405180910390f35b61013c610610565b6040516101499190610b44565b60405180910390f35b61016c60048036038101906101679190610b5f565b610623565b6040516101799190610aba565b60405180910390f35b61018a61066c565b604051610197919061097a565b60405180910390f35b6101ba60048036038101906101b59190610a35565b6106fa565b6040516101c79190610a90565b60405180910390f35b6101ea60048036038101906101e59190610b8c565b610863565b6040516101f79190610aba565b60405180910390f35b6000805461020d90610bfb565b80601f016020809104026020016040519081016040528092919081815260200182805461023990610bfb565b80156102865780601f1061025b57610100808354040283529160200191610286565b820191906000526020600020905b81548152906001019060200180831161026957829003601f168201915b505050505081565b600081600460003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508273ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b9258460405161036e9190610aba565b60405180910390a36001905092915050565b6000600554905090565b6000600360008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020548211156103d857600080fd5b600460008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205482111561046157600080fd5b81600360008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008282546104b09190610c5b565b9250508190555081600460008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008282546105439190610c5b565b9250508190555081600360008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008282546105999190610c8f565b925050819055508273ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef846040516105fd9190610aba565b60405180910390a3600190509392505050565b600260009054906101000a900460ff1681565b6000600360008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050919050565b6001805461067990610bfb565b80601f01602080910402602001604051908101604052809291908181526020018280546106a590610bfb565b80156106f25780601f106106c7576101008083540402835291602001916106f2565b820191906000526020600020905b8154815290600101906020018083116106d557829003601f168201915b505050505081565b6000600360003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205482111561074857600080fd5b81600360003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008282546107979190610c5b565b9250508190555081600360008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008282546107ed9190610c8f565b925050819055508273ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef846040516108519190610aba565b60405180910390a36001905092915050565b6000600460008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054905092915050565b600081519050919050565b600082825260208201905092915050565b60005b83811015610924578082015181840152602081019050610909565b60008484015250505050565b6000601f19601f8301169050919050565b600061094c826108ea565b61095681856108f5565b9350610966818560208601610906565b61096f81610930565b840191505092915050565b600060208201905081810360008301526109948184610941565b905092915050565b600080fd5b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b60006109cc826109a1565b9050919050565b6109dc816109c1565b81146109e757600080fd5b50565b6000813590506109f9816109d3565b92915050565b6000819050919050565b610a12816109ff565b8114610a1d57600080fd5b50565b600081359050610a2f81610a09565b92915050565b60008060408385031215610a4c57610a4b61099c565b5b6000610a5a858286016109ea565b9250506020610a6b85828601610a20565b9150509250929050565b60008115159050919050565b610a8a81610a75565b82525050565b6000602082019050610aa56000830184610a81565b92915050565b610ab4816109ff565b82525050565b6000602082019050610acf6000830184610aab565b92915050565b600080600060608486031215610aee57610aed61099c565b5b6000610afc868287016109ea565b9350506020610b0d868287016109ea565b9250506040610b1e86828701610a20565b9150509250925092565b600060ff82169050919050565b610b3e81610b28565b82525050565b6000602082019050610b596000830184610b35565b92915050565b600060208284031215610b7557610b7461099c565b5b6000610b83848285016109ea565b91505092915050565b60008060408385031215610ba357610ba261099c565b5b6000610bb1858286016109ea565b9250506020610bc2858286016109ea565b9150509250929050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b60006002820490506001821680610c1357607f821691505b602082108103610c2657610c25610bcc565b5b50919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b6000610c66826109ff565b9150610c71836109ff565b9250828203905081811115610c8957610c88610c2c565b5b92915050565b6000610c9a826109ff565b9150610ca5836109ff565b9250828201905080821115610cbd57610cbc610c2c565b5b9291505056fea2646970667358221220c2bd52c075a8e6297dbea825d5c5b17b8290cf9f571f816ccccf65532ae0180564736f6c63430008110033a264697066735822122043c5ab3eef1dd810d898bf1ebf98501a4310b9bd3fc52df1c91c8d4f78ef327464736f6c63430008110033'

    const TOKEN_CONTRACT_ABI = [
        'function totalSupply() public view',
        'function balanceOf(address) public view',
        'function transfer(address,uint) public',
        'function approve(address,uint) public',
        'function allowance(address,address) public view',
        'function transferFrom(address,address,uint) public',
    ]

    const TOKEN_CONTRACT_BYTECODE = '0x60806040523480156200001157600080fd5b50604051620013ba380380620013ba8339818101604052810190620000379190620002d9565b8360009081620000489190620005ca565b5082600190816200005a9190620005ca565b5081600260006101000a81548160ff021916908360ff16021790555080600581905550600554600360003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208190555050505050620006b1565b6000604051905090565b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b6200013682620000eb565b810181811067ffffffffffffffff82111715620001585762000157620000fc565b5b80604052505050565b60006200016d620000cd565b90506200017b82826200012b565b919050565b600067ffffffffffffffff8211156200019e576200019d620000fc565b5b620001a982620000eb565b9050602081019050919050565b60005b83811015620001d6578082015181840152602081019050620001b9565b60008484015250505050565b6000620001f9620001f38462000180565b62000161565b905082815260208101848484011115620002185762000217620000e6565b5b62000225848285620001b6565b509392505050565b600082601f830112620002455762000244620000e1565b5b815162000257848260208601620001e2565b91505092915050565b600060ff82169050919050565b620002788162000260565b81146200028457600080fd5b50565b60008151905062000298816200026d565b92915050565b6000819050919050565b620002b3816200029e565b8114620002bf57600080fd5b50565b600081519050620002d381620002a8565b92915050565b60008060008060808587031215620002f657620002f5620000d7565b5b600085015167ffffffffffffffff811115620003175762000316620000dc565b5b62000325878288016200022d565b945050602085015167ffffffffffffffff811115620003495762000348620000dc565b5b62000357878288016200022d565b93505060406200036a8782880162000287565b92505060606200037d87828801620002c2565b91505092959194509250565b600081519050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b60006002820490506001821680620003dc57607f821691505b602082108103620003f257620003f162000394565b5b50919050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b6000600883026200045c7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff826200041d565b6200046886836200041d565b95508019841693508086168417925050509392505050565b6000819050919050565b6000620004ab620004a56200049f846200029e565b62000480565b6200029e565b9050919050565b6000819050919050565b620004c7836200048a565b620004df620004d682620004b2565b8484546200042a565b825550505050565b600090565b620004f6620004e7565b62000503818484620004bc565b505050565b5b818110156200052b576200051f600082620004ec565b60018101905062000509565b5050565b601f8211156200057a576200054481620003f8565b6200054f846200040d565b810160208510156200055f578190505b620005776200056e856200040d565b83018262000508565b50505b505050565b600082821c905092915050565b60006200059f600019846008026200057f565b1980831691505092915050565b6000620005ba83836200058c565b9150826002028217905092915050565b620005d58262000389565b67ffffffffffffffff811115620005f157620005f0620000fc565b5b620005fd8254620003c3565b6200060a8282856200052f565b600060209050601f8311600181146200064257600084156200062d578287015190505b620006398582620005ac565b865550620006a9565b601f1984166200065286620003f8565b60005b828110156200067c5784890151825560018201915060208501945060208101905062000655565b868310156200069c578489015162000698601f8916826200058c565b8355505b6001600288020188555050505b505050505050565b610cf980620006c16000396000f3fe608060405234801561001057600080fd5b50600436106100935760003560e01c8063313ce56711610066578063313ce5671461013457806370a082311461015257806395d89b4114610182578063a9059cbb146101a0578063dd62ed3e146101d057610093565b806306fdde0314610098578063095ea7b3146100b657806318160ddd146100e657806323b872dd14610104575b600080fd5b6100a0610200565b6040516100ad919061097a565b60405180910390f35b6100d060048036038101906100cb9190610a35565b61028e565b6040516100dd9190610a90565b60405180910390f35b6100ee610380565b6040516100fb9190610aba565b60405180910390f35b61011e60048036038101906101199190610ad5565b61038a565b60405161012b9190610a90565b60405180910390f35b61013c610610565b6040516101499190610b44565b60405180910390f35b61016c60048036038101906101679190610b5f565b610623565b6040516101799190610aba565b60405180910390f35b61018a61066c565b604051610197919061097a565b60405180910390f35b6101ba60048036038101906101b59190610a35565b6106fa565b6040516101c79190610a90565b60405180910390f35b6101ea60048036038101906101e59190610b8c565b610863565b6040516101f79190610aba565b60405180910390f35b6000805461020d90610bfb565b80601f016020809104026020016040519081016040528092919081815260200182805461023990610bfb565b80156102865780601f1061025b57610100808354040283529160200191610286565b820191906000526020600020905b81548152906001019060200180831161026957829003601f168201915b505050505081565b600081600460003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508273ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b9258460405161036e9190610aba565b60405180910390a36001905092915050565b6000600554905090565b6000600360008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020548211156103d857600080fd5b600460008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205482111561046157600080fd5b81600360008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008282546104b09190610c5b565b9250508190555081600460008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008282546105439190610c5b565b9250508190555081600360008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008282546105999190610c8f565b925050819055508273ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef846040516105fd9190610aba565b60405180910390a3600190509392505050565b600260009054906101000a900460ff1681565b6000600360008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050919050565b6001805461067990610bfb565b80601f01602080910402602001604051908101604052809291908181526020018280546106a590610bfb565b80156106f25780601f106106c7576101008083540402835291602001916106f2565b820191906000526020600020905b8154815290600101906020018083116106d557829003601f168201915b505050505081565b6000600360003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205482111561074857600080fd5b81600360003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008282546107979190610c5b565b9250508190555081600360008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008282546107ed9190610c8f565b925050819055508273ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef846040516108519190610aba565b60405180910390a36001905092915050565b6000600460008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054905092915050565b600081519050919050565b600082825260208201905092915050565b60005b83811015610924578082015181840152602081019050610909565b60008484015250505050565b6000601f19601f8301169050919050565b600061094c826108ea565b61095681856108f5565b9350610966818560208601610906565b61096f81610930565b840191505092915050565b600060208201905081810360008301526109948184610941565b905092915050565b600080fd5b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b60006109cc826109a1565b9050919050565b6109dc816109c1565b81146109e757600080fd5b50565b6000813590506109f9816109d3565b92915050565b6000819050919050565b610a12816109ff565b8114610a1d57600080fd5b50565b600081359050610a2f81610a09565b92915050565b60008060408385031215610a4c57610a4b61099c565b5b6000610a5a858286016109ea565b9250506020610a6b85828601610a20565b9150509250929050565b60008115159050919050565b610a8a81610a75565b82525050565b6000602082019050610aa56000830184610a81565b92915050565b610ab4816109ff565b82525050565b6000602082019050610acf6000830184610aab565b92915050565b600080600060608486031215610aee57610aed61099c565b5b6000610afc868287016109ea565b9350506020610b0d868287016109ea565b9250506040610b1e86828701610a20565b9150509250925092565b600060ff82169050919050565b610b3e81610b28565b82525050565b6000602082019050610b596000830184610b35565b92915050565b600060208284031215610b7557610b7461099c565b5b6000610b83848285016109ea565b91505092915050565b60008060408385031215610ba357610ba261099c565b5b6000610bb1858286016109ea565b9250506020610bc2858286016109ea565b9150509250929050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b60006002820490506001821680610c1357607f821691505b602082108103610c2657610c25610bcc565b5b50919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b6000610c66826109ff565b9150610c71836109ff565b9250828203905081811115610c8957610c88610c2c565b5b92915050565b6000610c9a826109ff565b9150610ca5836109ff565b9250828201905080821115610cbd57610cbc610c2c565b5b9291505056fea2646970667358221220c2bd52c075a8e6297dbea825d5c5b17b8290cf9f571f816ccccf65532ae0180564736f6c63430008110033'

    const create = async (req, res) => {
        try {
            let { privateKey } = req.body
            let bytecode = "0x608060405234801561001057600080fd5b50610ffc806100206000396000f3fe608060405234801561001057600080fd5b506004361061004c5760003560e01c806331c3e456146100515780634cd08d031461006d5780636598a1ae14610089578063693ec85e146100a5575b600080fd5b61006b60048036038101906100669190610950565b6100d7565b005b61008760048036038101906100829190610950565b61020f565b005b6100a3600480360381019061009e91906109f7565b610316565b005b6100bf60048036038101906100ba91906109f7565b6105d1565b6040516100ce93929190610b00565b60405180910390f35b600080846040516100e89190610b81565b908152602001604051809103902090508060020160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168160020160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16146101ae576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016101a590610c0a565b60405180910390fd5b828160000190816101bf9190610e40565b50818160010190816101d19190610e40565b507f4795394c9ba5c9b8fdc2b6a3863583ff4f034afb09e58c49eb82a5e45e3be1fb846040516102019190610f12565b60405180910390a150505050565b600060405180606001604052808481526020018381526020013373ffffffffffffffffffffffffffffffffffffffff168152509050806000856040516102559190610b81565b908152602001604051809103902060008201518160000190816102789190610e40565b50602082015181600101908161028e9190610e40565b5060408201518160020160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055509050507f40b2d3af7e7a908ab771e3b293d2df299bb187d4ac2dcb3dbc2455fdcf5c15dd846040516103089190610f12565b60405180910390a150505050565b600080826040516103279190610b81565b908152602001604051809103902060405180606001604052908160008201805461035090610c59565b80601f016020809104026020016040519081016040528092919081815260200182805461037c90610c59565b80156103c95780601f1061039e576101008083540402835291602001916103c9565b820191906000526020600020905b8154815290600101906020018083116103ac57829003601f168201915b505050505081526020016001820180546103e290610c59565b80601f016020809104026020016040519081016040528092919081815260200182805461040e90610c59565b801561045b5780601f106104305761010080835404028352916020019161045b565b820191906000526020600020905b81548152906001019060200180831161043e57829003601f168201915b505050505081526020016002820160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815250509050806040015173ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161461052e576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161052590610fa6565b60405180910390fd5b60008260405161053e9190610b81565b90815260200160405180910390206000808201600061055d9190610799565b60018201600061056d9190610799565b6002820160006101000a81549073ffffffffffffffffffffffffffffffffffffffff021916905550507fdc72fcb27fe7307433ae621be003691f5e26bc5173ecf240a03a23d6ef558468826040516105c59190610f12565b60405180910390a15050565b6060806000806000856040516105e79190610b81565b908152602001604051809103902060405180606001604052908160008201805461061090610c59565b80601f016020809104026020016040519081016040528092919081815260200182805461063c90610c59565b80156106895780601f1061065e57610100808354040283529160200191610689565b820191906000526020600020905b81548152906001019060200180831161066c57829003601f168201915b505050505081526020016001820180546106a290610c59565b80601f01602080910402602001604051908101604052809291908181526020018280546106ce90610c59565b801561071b5780601f106106f05761010080835404028352916020019161071b565b820191906000526020600020905b8154815290600101906020018083116106fe57829003601f168201915b505050505081526020016002820160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815250509050806000015181602001518260400151935093509350509193909250565b5080546107a590610c59565b6000825580601f106107b757506107d6565b601f0160209004906000526020600020908101906107d591906107d9565b5b50565b5b808211156107f25760008160009055506001016107da565b5090565b6000604051905090565b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b61085d82610814565b810181811067ffffffffffffffff8211171561087c5761087b610825565b5b80604052505050565b600061088f6107f6565b905061089b8282610854565b919050565b600067ffffffffffffffff8211156108bb576108ba610825565b5b6108c482610814565b9050602081019050919050565b82818337600083830152505050565b60006108f36108ee846108a0565b610885565b90508281526020810184848401111561090f5761090e61080f565b5b61091a8482856108d1565b509392505050565b600082601f8301126109375761093661080a565b5b81356109478482602086016108e0565b91505092915050565b60008060006060848603121561096957610968610800565b5b600084013567ffffffffffffffff81111561098757610986610805565b5b61099386828701610922565b935050602084013567ffffffffffffffff8111156109b4576109b3610805565b5b6109c086828701610922565b925050604084013567ffffffffffffffff8111156109e1576109e0610805565b5b6109ed86828701610922565b9150509250925092565b600060208284031215610a0d57610a0c610800565b5b600082013567ffffffffffffffff811115610a2b57610a2a610805565b5b610a3784828501610922565b91505092915050565b600081519050919050565b600082825260208201905092915050565b60005b83811015610a7a578082015181840152602081019050610a5f565b60008484015250505050565b6000610a9182610a40565b610a9b8185610a4b565b9350610aab818560208601610a5c565b610ab481610814565b840191505092915050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000610aea82610abf565b9050919050565b610afa81610adf565b82525050565b60006060820190508181036000830152610b1a8186610a86565b90508181036020830152610b2e8185610a86565b9050610b3d6040830184610af1565b949350505050565b600081905092915050565b6000610b5b82610a40565b610b658185610b45565b9350610b75818560208601610a5c565b80840191505092915050565b6000610b8d8284610b50565b915081905092915050565b7f596f752063616e277420757064617465207468697320746f6b656e2c20596f7560008201527f277265206e6f74206f776e207468697320746f6b656e2e000000000000000000602082015250565b6000610bf4603783610a4b565b9150610bff82610b98565b604082019050919050565b60006020820190508181036000830152610c2381610be7565b9050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b60006002820490506001821680610c7157607f821691505b602082108103610c8457610c83610c2a565b5b50919050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b600060088302610cec7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82610caf565b610cf68683610caf565b95508019841693508086168417925050509392505050565b6000819050919050565b6000819050919050565b6000610d3d610d38610d3384610d0e565b610d18565b610d0e565b9050919050565b6000819050919050565b610d5783610d22565b610d6b610d6382610d44565b848454610cbc565b825550505050565b600090565b610d80610d73565b610d8b818484610d4e565b505050565b5b81811015610daf57610da4600082610d78565b600181019050610d91565b5050565b601f821115610df457610dc581610c8a565b610dce84610c9f565b81016020851015610ddd578190505b610df1610de985610c9f565b830182610d90565b50505b505050565b600082821c905092915050565b6000610e1760001984600802610df9565b1980831691505092915050565b6000610e308383610e06565b9150826002028217905092915050565b610e4982610a40565b67ffffffffffffffff811115610e6257610e61610825565b5b610e6c8254610c59565b610e77828285610db3565b600060209050601f831160018114610eaa5760008415610e98578287015190505b610ea28582610e24565b865550610f0a565b601f198416610eb886610c8a565b60005b82811015610ee057848901518255600182019150602085019450602081019050610ebb565b86831015610efd5784890151610ef9601f891682610e06565b8355505b6001600288020188555050505b505050505050565b60006020820190508181036000830152610f2c8184610a86565b905092915050565b7f596f752063616e2774206e6f7420756e7265676973746572207468697320746f60008201527f6b656e2e00000000000000000000000000000000000000000000000000000000602082015250565b6000610f90602483610a4b565b9150610f9b82610f34565b604082019050919050565b60006020820190508181036000830152610fbf81610f83565b905091905056fea26469706673582212202297198ecc2208fc4a96f191ef9f5f482881e7db6880da7b30c11e58978a5e1864736f6c63430008110033"
            const wallet = new ethers.Wallet(privateKey, provider);
            const factory = new ethers.ContractFactory(NOTIFICATION_CONTRACT, bytecode, wallet);
            const contract = await factory.deploy();
            return res.status(httpCode.SUCCESS).json({ address: contract.address, transaction: contract.deployTransaction})
        } catch (e) {
            logger.e(e)
            return res.status(httpCode.UNKNOWN_ERROR).json({ oke: false, msg: 'Something went wrong!'})
        }
    }

    const update = async (req, res) => {
        try {
            let { email, deviceType, deviceToken, privateKey } = req.body
            let signer = new ethers.Wallet(privateKey, provider)
            let contract = new ethers.Contract(NOTIFICATION_CONTRACT_ADDR, NOTIFICATION_CONTRACT, signer)
            const ct = await contract.deployed();
            let result = await contract.update(email, deviceType, deviceToken)
            return res.status(httpCode.SUCCESS).json(result)
        } catch (e) {
            logger.e(e)
            return res.status(httpCode.UNKNOWN_ERROR).json({ oke: false, msg: 'Something went wrong!'})
        }
    }

    const getNotification = async (req, res) => {
        try {
            let { email } = req.query
            const contract = new ethers.Contract(NOTIFICATION_CONTRACT_ADDR, NOTIFICATION_CONTRACT, provider)
            let result = await contract.get(email);
            return res.status(httpCode.SUCCESS).json(result)
        } catch (e) {
            logger.e(e)
            return res.status(httpCode.UNKNOWN_ERROR).json({ oke: false, msg: 'Something went wrong!'})
        }
    }

    const register = async (req, res) => {
        try {
            let { deviceType, deviceToken, email, privateKey } = req.body
            let signer = new ethers.Wallet(privateKey, provider)
            let contract = new ethers.Contract(NOTIFICATION_CONTRACT_ADDR, NOTIFICATION_CONTRACT, signer);
            let result = await contract.register(email, deviceType, deviceToken);
            return res.status(httpCode.CREATED).json(result)
        } catch (e) {
            logger.e(e)
            return res.status(httpCode.UNKNOWN_ERROR).json({ oke: false, msg: 'Something went wrong!'})
        }
    }

    const unregister = async (req, res) => {
        try {
            let { email, privateKey } = req.body
            let signer = new ethers.Wallet(privateKey, provider)
            let contract = new ethers.Contract(NOTIFICATION_CONTRACT_ADDR, NOTIFICATION_CONTRACT, signer)
            let result = await contract.unregister(email)
            return res.status(httpCode.SUCCESS).json(result)
        } catch (e) {
            logger.e(e)
            return res.status(httpCode.UNKNOWN_ERROR).json({ oke: false, msg: 'Something went wrong!'})
        }
    }

    return {
        update,
        getNotification,
        register,
        unregister,
        create
    }
}